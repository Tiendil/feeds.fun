# alpha-config.yaml
#
# Use with:
#   oauth2-proxy \
#     --alpha-config=/etc/oauth2-proxy/alpha-config.yaml \
#     --cookie-secret=<base64-32> \
#     --cookie-name=ffun_session \
#     --cookie-domain=feeds.fun.local \
#     --cookie-secure=true \
#     --cookie-httponly=true \
#     --cookie-samesite=strict \
#     --cookie-expire=8760h0m0s   # â‰ˆ 1 year, matches 31536000s \
#     --cookie-refresh=0          # or tune as you like \
#     --http-address=0.0.0.0:4180

server:
  BindAddress: "0.0.0.0:8000"
  SecureBindAddress: "-"

providers:
  - id: primary_oidc
    provider: keycloak-oidc

    clientID: gateway-client
    clientSecret: a5tAGfAvr1A2nACmPRSlxMTJyJ6yoEuq
    # TODO: try to remove email scope
    scope: "openid email"

    oidcConfig:
      issuerURL: "https://idp.feeds.fun.local/realms/dev"
      userIDClaim: "sub"
      emailClaim: "email" # TODO: try to remove
      audienceClaims:
        - "aud"
      # extraAudiences: []

    loginURLParameters:
      - name: prompt
        allow:
          - value: create

    code_challenge_method: "S256"

    backendLogoutURL: https://idp.feeds.fun.local/realms/dev/protocol/openid-connect/logout?id_token_hint={id_token}

    # useSystemTrustStore: true
    caFiles:
      - /caddy-data/caddy/pki/authorities/local/root.crt

injectResponseHeaders:

  - name: "X-FFun-User-Id"
    preserveRequestValue: false
    values:
      - claim: "user"

  - name: "X-FFun-Identity-Provider-Id"
    preserveRequestValue: false
    values:
      # base64("primary_oidc")
      - value: "cHJpbWFyeV9vaWRjCg=="
